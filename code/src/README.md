# Collector Development environment documentation

All paths are related to **COLLECTOR_HOME** Folder which defaults to /home/<username>/collector

## Shell scripts

Shell scripts sould live in Binaries (/bin) folder:

| Script      | Description | Comments                                                           |
| ------      | ----------- | --------                                                           |
| bk.sh       | Backup      | used to generate a daily backup of development environment         |
|             |             | destination is: **COLLECTOR_HOME**/bkup                            |
|             |             | files:                                                             |
|             |             | bkup_collector_AAAAMMDD-HHMMSS.tgz has Code                        |
|             |             | bkup_collector_db_tables_AAAAMMDD-HHMM.tgz has DB backup by table  |
|             |             | dump_collector_db_AAAAMMDD-HHMMSS.sql.tgz full DB SQL backup       |
| export.sh   | Export      | Exports development environment files to actual execution folder   |
| package.sh  | Package     | Creates a new Collector Package                                    |
|             |             | moves old packages to package folder and creates a new one named:  |
|             |             | Collector_AAAAMMDD_HHMMSS.tar                                      |
|             |             | Package should include app/service/install/bin folders and home    |
|             |             | required files (collector*,*.py,*.txt,*.md)                        |
| stats.sh    | Statistics  | Generates some devlopment stastistics                              |
|             |             |                                                                    |


## Collector's Folders ##

This folders are depending on the Collector's HOME folder, some should be replicated on production environments


| Folder      | Use          | Env | Comments                                                             |
| ------      | -----------  | --- | --------                                                             |
| app         | Application  | Y   | Main application folder, contains Collector Web Interface code       |
| bin         | Binaries     | Y   |  Contains all binaries that can be executed by Applications, this    |
|             |              |     | folder should be included in users's PATH variable                   |
| bkup        | Backup       | N   |  Contains development backup files, contains of this folder must     |
|             |              |     |  be moved to remote repository periodically                          |
| install     | Installation | N   |  Contains all productive versions of files required for a full       |
|             |              |     |  Collector application installation                                  |
| log         | Audit Log    | Y   |  Saves default audit log records generated by Collector applications |                                                                    |
| packages    | Packages     | N   |  Saves packaged versions of collector development environment        |
| service     |              | Y   |  Main folder for Collector Backend code                              |
| tools       | Tools        | N   |  Tools folder to support development activities, like automatic code |
|             |              | N   |  generation                                                          |
| test        | Test         | N   |  Internal test environment for code evaluatin purpouses non of this  |
|             |              |     |  code should become part or installation versions                    |
| venv        | Virtual Env. | Y   |  Collector uses virtual environment to specify module versions, this |
|             |              |     |  resides here an shoul be replicated in production environments,     |
|             |              |     |  installation code should consider venv regeneration/update          |

## Other Paths ##

| Path                | Use          | Description |
| ----                | ---          | ----------- |
| /etc/systemd/system | services     | Path to Collectors Service Calls. Collector's services should be symbolic |
|                     |              | linked to this path in order to be executed.                              |
|                     |              | * **/service/collectord.service**     BackEnd Deamon                      |
|                     |              | * **/service/collectorwd.service**    Web Server Deamon                   |

## Execution Pre-Requisis

### Back-End Daemon ###
/etc/systemd/system/collectord.service
executes: /usr/local/bin/collectord

/usr/local/bin/collectord
defines working folder: COLLECTOR_ROOT
cd: working folder
source: collector_exports
source: venv/bin/activate
executes: python collectord.py

### Front-End Daemon ###
/etc/systemd/system/collectord.service
executes: /usr/local/bin/collectorwd

/usr/local/bin/collectorwd
defines working folder: COLLECTOR_ROOT
cd: working folder
source: collector_exports
source: venv/bin/activate

> Excecutes Daemon
> Test Command is:
> python collector.py runserver --host 0.0.0.0
> Runtime:
> gunicorn handles charge balance an runs service in port 8000
> NGinX then Reverses proxy calls to this server

executes: gunicorn collector:app --timeout 300


